<!DOCTYPE html>
<html class="no-js" lang="es">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenido | Diario Web</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/motion-ui/1.2.3/motion-ui.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation-prototype.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <!-- Start Top Bar -->
    <div class="top-bar">
      <div class="top-bar-left">
        <ul class="menu">
          <li class="menu-text">Organización o persona</li>
        </ul>
      </div>
      <div class="top-bar-right">
        <ul class="menu">
          <li><a href="#">Acceso</a></li>
          <li><a href="#">Administración</a></li>
        </ul>
      </div>
    </div>
    <!-- End Top Bar -->
    <div class="callout large primary">
      <div class="text-center">
        <h1>Diario web</h1>
      </div>
    </div>
    <section class="grid-container">
      <div class="grid-x grid-margin-x" id="content">
        <div class="medium-9 cell">
            <h1>Lista de Publicaciones</h1>
            <ul id="publicaciones-container">
                <!-- Publicaciones se cargan -->
            </ul>
        </div>
        <aside class="medium-3 cell" data-sticky-container="">
          <div class="sticky" data-sticky="" data-anchor="content">
            <h4>Categorías</h4>
            <ul>
              <li><a href="#">Cat1</a></li>
            </ul>
            <h4>Autores</h4>
            <ul id="autor-container">
                <% autores.forEach(autor => { %>
                <!-- Autor se cargan -->
                    <li><a href="/autor/<%= autor.ID %>"><%= autor.Nombre %> <%= autor.Apellido %></a></li>
                <% }); %>
            </ul>
          </div>
        </aside>
      </div>
      <div>
        <ul class="pagination" role="navigation" aria-label="Pagination" id="pagination-container">
        </ul>
      </div>
    </section>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/js/foundation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/motion-ui/1.2.3/motion-ui.min.js"></script>
    <script>
        // Función para cargar más publicaciones mediante AJAX
        function cargarMasPublicaciones(page) {
            $.ajax({
                url: '/publicaciones/paginadas?page=' + page,
                type: 'GET',
                success: function (data) {
                    const publicaciones = data.publications;
                    const totalPages = data.totalPages;

                    // Limpia el contenedor de publicaciones
                    $('#publicaciones-container').empty();

                    // Agrega las publicaciones al contenedor
                    publicaciones.forEach(function (publicacion) {
                        const textoRecortado = publicacion.Texto.length > 300 ? publicacion.Texto.substring(0, 300) + "..." : publicacion.Texto;
                        $('#publicaciones-container').append(
                            `<li>
                                <h2><a href="/publicacion/${publicacion.ID} ">${publicacion.Titulo}</a></h2>
                                <p>${publicacion.Imagen}</p>
                                <p>Fecha: ${publicacion.Fecha}</p>
                                <p>Categoria: ${publicacion.Categoria}</p>
                                <p>Autor: <a href="/autor/${publicacion.autorId}">${publicacion.autorId}</a></p>
                                <p>Texto: ${textoRecortado}</p>
                            </li>`
                        );
                    });
                    // Limpia el contenedor de paginación
                    $('#pagination-container').empty();

                    // Agrega la barra de paginación
                    for (let i = 1; i <= totalPages; i++) {
                        $('#pagination-container').append(
                            `<li><button class="page-link" data-page="${i}">${i}</button></li>`
                        );
                    }

                    // Agrega el manejador de eventos a los botones de la paginación
                    $('.page-link').on('click', function () {
                        const page = $(this).data('page');
                        cargarMasPublicaciones(page);
                    });
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

        // Carga las primeras 5 publicaciones al cargar la página
        cargarMasPublicaciones(1);
    </script>
  </body>
</html>